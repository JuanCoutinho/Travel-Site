<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rota Express</title>
    <link rel="stylesheet" href="style/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css"
    />
    <style>
      .card-section {
        padding: 20px;
        background-color: #f9f9f9;
      }

      .flight-carousel {
        display: flex;
        flex-wrap: nowrap; /* Permite que os cards fiquem em linha */
        overflow: hidden; /* Oculta o conteúdo que ultrapassar a largura */
      }

      .card {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin: 10px;
        padding: 15px;
        width: 300px; /* A largura do card pode ser mantida ou ajustada */
        text-align: center;
        transition: transform 0.3s;
      }

      .card:hover {
        transform: scale(1.05);
      }

      .card-img {
        width: 100%;
        border-radius: 10px;
        height: auto;
      }

      .card h3 {
        font-size: 1.2em;
        margin: 10px 0;
      }

      .card p {
        font-size: 0.9em;
        color: #555;
        margin: 5px 0;
      }

      /* Ajuste para que os cards se comportem corretamente no carrossel */
      .slick-slide {
        display: flex; /* Alinha os itens do carrossel */
        justify-content: center; /* Centraliza os cards no slide */
      }

      @media (max-width: 768px) {
        .card {
          width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <ul>
          <li><a href="#home">Home</a></li>
          <li><a href="#viagens">Viagens</a></li>
          <li><a href="#sobre">Sobre</a></li>
          <li><a href="#informacoes">Informações</a></li>
        </ul>
      </nav>
      <div class="logo" id="home">
        <h1>Rota Express</h1>
        <img src="img/logotipo.png" alt="Logo Rota Express" width="200px" />
      </div>
      <p>
        Rota Express: Fácil, rápido e dinâmico. Confira agora as viagens mais
        baratas do mercado!
      </p>
    </header>

    <section class="card-section" id="viagens">
      <div class="flight-carousel"></div>
    </section>

    <section class="principles-section" id="sobre">
      <h2>Nossos Princípios</h2>
      <div class="principles-container">
        <div class="principle">
          <img src="img/money_icon.png" alt="Ícone 1" width="80px" />
          <h3>Viagens Baratas</h3>
          <p>
            Ajudamos você a encontrar as viagens mais econômicas do mercado.
          </p>
        </div>
        <div class="principle">
          <img src="img/time_icon.png" alt="Ícone 2" width="80px" />
          <h3>Poupar Tempo</h3>
          <p>
            Nosso objetivo é agilizar o processo de busca para poupar seu tempo.
          </p>
        </div>
        <div class="principle">
          <img src="img/search_icon.png" alt="Ícone 3" width="80px" />
          <h3>Diferencial no Mercado</h3>
          <p>
            Temos a melhor tecnologia para facilitar a busca das melhores
            opções.
          </p>
        </div>
      </div>
    </section>

    <section class="info-section" id="informacoes">
      <h2>Notícias de Aviação</h2>
      <div class="carousel">
        <div class="carousel-item">
          <img src="static/img/news1.jpg" alt="Notícia 1" />
          <p>Avião faz pouso de emergência em São Paulo</p>
        </div>
        <div class="carousel-item">
          <img src="static/img/news2.jpg" alt="Notícia 2" />
          <p>Novas rotas internacionais serão inauguradas este ano</p>
        </div>
        <div class="carousel-item">
          <img src="static/img/news3.jpg" alt="Notícia 3" />
          <p>Companhias aéreas oferecem descontos para viagens em 2024</p>
        </div>
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script src="js/script.js"></script>
    <script>
      const clientId = "k2wiffvdlH3Uhb05j7NGyw2GrO6rzY4E";
      const clientSecret = "4UtBaRC3A15aODsi";
      const exchangeRateApiKey = "f0a82d5f3400636152941e1a";

      // Função para obter o token de autenticação da API Amadeus
      async function getAuthToken() {
        const response = await fetch(
          "https://test.api.amadeus.com/v1/security/oauth2/token",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({
              grant_type: "client_credentials",
              client_id: clientId,
              client_secret: clientSecret,
            }),
          }
        );

        const data = await response.json();
        return data.access_token;
      }

      // Função para buscar as ofertas de voos
      async function fetchFlights(origin, destination, departureDate, adults) {
        const token = await getAuthToken();
        const formattedDepartureDate = new Date(departureDate)
          .toISOString()
          .split("T")[0];

        const response = await fetch(
          `https://test.api.amadeus.com/v2/shopping/flight-offers?originLocationCode=${origin}&destinationLocationCode=${destination}&departureDate=${formattedDepartureDate}&adults=${adults}`,
          {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          }
        );

        return await response.json();
      }

      // Função para buscar a cotação do Euro para BRL
      async function fetchExchangeRate() {
        try {
          const response = await fetch(
            `https://v6.exchangerate-api.com/v6/${exchangeRateApiKey}/latest/EUR`
          );

          if (!response.ok) {
            throw new Error("Erro ao obter a cotação do euro");
          }

          const data = await response.json();
          return data.conversion_rates.BRL; // Taxa de conversão de EUR para BRL
        } catch (error) {
          console.error(error);
          return null;
        }
      }

      async function displayFlights() {
        const exchangeRate = await fetchExchangeRate(); // Obter a cotação BRL/EUR
        if (!exchangeRate) {
          console.error("Não foi possível obter a cotação do euro");
          return;
        }

        const flightsData = await fetchFlights("SAO", "RIO", "2024-11-10", 1);
        const flights = flightsData.data.slice(0, 12);

        const carousel = document.querySelector(".flight-carousel");
        carousel.innerHTML = "";

        flights.forEach((flight) => {
          const priceInEur = flight.price.total;
          const priceInBrl = (priceInEur * exchangeRate).toFixed(2);

          const card = document.createElement("div");
          card.classList.add("card");

          card.innerHTML = `
      <img src="${
        flight.lastPrice?.logo || "default.jpg"
      }" alt="Viagem" class="card-img">
      <h3>${flight.itineraries[0].segments[0].departure.iataCode} - ${
            flight.itineraries[0].segments[0].arrival.iataCode
          }</h3>
      <p>Preço: €${priceInEur} / R$${priceInBrl}</p>
      <p>Embarque: ${flight.itineraries[0].segments[0].departure.iataCode}</p>
      <p>Destino: ${flight.itineraries[0].segments[0].arrival.iataCode}</p>
      <p>Classe: ${flight.travelerPricings[0].fareFamilies}</p>
    `;

          carousel.appendChild(card);
        });

        $(".flight-carousel").slick({
          slidesToShow: 3,
          slidesToScroll: 1,
          infinite: true,
          dots: false,
          arrows: false,
          autoplay: true,
          autoplaySpeed: 2000,
          responsive: [
            {
              breakpoint: 768,
              settings: {
                slidesToShow: 1,
              },
            },
          ],
        });
      }

      displayFlights();
    </script>
  </body>
</html>
